<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Using R for Everything: ä½¿ç”¨ ggplot2 å¯è§†åŒ– RDA ç»“æœ | æ´—è¡£æœºç”¨æˆ·ä¸ä¼šç”¨æ´—è¡£æœº</title>
<meta name="description" content="Why be a researcher if you can be an Engineer?">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://womeimingzi11.github.io/favicon.ico?v=1600981403297">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://womeimingzi11.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://womeimingzi11.github.io">
        <img src="https://womeimingzi11.github.io/images/avatar.png?v=1600981403297" class="site-logo">
        <h1 class="site-title">æ´—è¡£æœºç”¨æˆ·ä¸ä¼šç”¨æ´—è¡£æœº</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      Why be a researcher if you can be an Engineer?
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://womeimingzi11.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Using R for Everything: ä½¿ç”¨ ggplot2 å¯è§†åŒ– RDA ç»“æœ</h2>
            <div class="post-date">2020-04-28</div>
            
              <div class="feature-container" style="background-image: url('https://womeimingzi11.github.io/post-images/vY312ek1B.png')">
              </div>
            
            <div class="post-content">
              <h1 id="using-r-for-everything-ggplot2-å¯è§†åŒ–-rda-ç»“æœ">Using R for Everything: ggplot2 å¯è§†åŒ– RDA ç»“æœ</h1>
<p>å…³äº RDAï¼ˆRedundancy analysis å†—ä½™åˆ†æï¼‰æ˜¯ä»€ä¹ˆï¼Œç›¸ä¿¡å¯¹äºå·²ç»æœ‰å¯è§†åŒ–éœ€æ±‚çš„åŒå­¦æ¥è¯´å·²ç»ä¸ç”¨æ›´å¤šçš„è§£é‡Šäº†ã€‚</p>
<p>åœ¨ R ä¸­å¸¸ç”¨æ¥è¿›è¡Œ RDA åˆ†æå’Œç»˜åˆ¶å·¥ä½œçš„æ˜¯ <a href="https://cran.r-project.org/web/packages/vegan/vegan.pdf">vegan</a> å’Œ <a href="https://github.com/gavinsimpson/ggvegan">ggvegan</a> è¿™ä¸¤ä¸ªåŒ…ã€‚ç„¶è€Œï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæœ€å¸¸é‡åˆ°çš„é—®é¢˜æ˜¯è™½ç„¶è¿™äº›åŒ…å†…å»ºçš„ plot ç­‰åŠŸèƒ½å¯ä»¥ç»˜åˆ¶å‡ºåŸºæœ¬å¯ç”¨çš„åŒ…ï¼Œä½†æƒ³è¦è¿›ä¸€æ­¥çš„å®šåˆ¶å›¾å½¢å´æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚</p>
<p>æƒ³è¦ç»˜åˆ¶å‡ºä¸€å‰¯è‡ªå·±æ»¡æ„ã€ç¼–è¾‘æ»¡æ„ã€å¯¼å¸ˆæ»¡æ„æœ€ä¸»è¦çš„æ˜¯å®¡ç¨¿äººæ»¡æ„çš„ RDA ç»“æœï¼Œä½œä¸ºæœ€å¼ºå¯è§†åŒ–å·¥å…·ä¹‹ä¸€çš„ <a href="https://ggplot2.tidyverse.org/">ggplot2</a> åŒ…æ¯‹åº¸ç½®ç–‘æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚</p>
<h2 id="æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ ·çš„-rda-å›¾">æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ ·çš„ RDA å›¾</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥æ€è€ƒæˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ ·çš„ RDA å›¾ï¼ŸæŒ‰ç…§ä¸–çºªéœ€æ±‚ä»¥åŠå®¡ç¨¿äººçš„å»ºè®®ï¼š</p>
<blockquote>
<p>I would recommend showing in bold the variables with significant correlations</p>
</blockquote>
<p>ç¬”è€…æœ€åçš„ç›®æ ‡æ˜¯ç»˜åˆ¶ä¸€å¹…ï¼š</p>
<pre><code>1. æ˜¾ç¤ºç‰©ç§ä¿¡æ¯ï¼ˆå®é™…ä¸Šæ˜¯å“åº”å˜é‡çŸ©é˜µï¼‰ï¼›
2. ç¯å¢ƒå˜é‡ï¼ˆå®é™…ä¸Šæ˜¯è§£é‡Šå˜é‡çŸ©é˜µï¼‰ï¼›
3. åœ¨ä¸¤è½´ä¸Šèƒ½æ˜¾ç¤ºå„è‡ªçš„è§£é‡Šåº¦ï¼›
4. æ ‡è®°æœ‰æ˜¾è‘—æ€§çš„è§£é‡Šå˜é‡ã€‚
</code></pre>
<p>ä»¥ç¬”è€…å¯¹ plot.rda ä»¥åŠ autoplot.rda è¿™ä¸¤ä¸ª vegan å’Œ ggvegan å†…å»ºå‡½æ•°çš„æµ…è–„äº†è§£ï¼Œä¼¼ä¹å¾ˆéš¾å®Œæˆã€‚</p>
<h3 id="å¦‚ä½•æ ‡è®°æœ‰æ˜¾è‘—æ€§çš„è§£é‡Šå˜é‡">å¦‚ä½•ã€Œæ ‡è®°æœ‰æ˜¾è‘—æ€§çš„è§£é‡Šå˜é‡ã€ï¼Ÿ</h3>
<p>å¦‚æœè¿›è¡Œè¿‡ RDA åˆ†æä¸éš¾å‘ç°ï¼Œä½¿ç”¨ vegan å†…å»ºçš„ rda æ˜¯æ²¡æœ‰æ ‡è®°è§£é‡Šå˜é‡çš„æ˜¾è‘—æ€§çš„ã€‚å…¶å®è¿™ç§æ˜¾è‘—æ€§éœ€è¦ vegan å†…å»ºçš„ envfit å‡½æ•°æ¥å¾—åˆ°ä¸€ä¸ªåŠå…¶è¿‘ä¼¼çš„ç»“æœã€‚é€šå¸¸è¿™ä¸ªæ–¹æ³•åœ¨è®ºæ–‡ä¸­ä¼šå†™ä½œï¼š</p>
<blockquote>
<p>Monte Carlo permutation (999 permutations) was used to identify axes with significant eigenvalues and species-environment correlations.</p>
</blockquote>
<p>ç”±äºæ˜¯è¿›è¡Œäº† 999 æ¬¡ï¼ˆé»˜è®¤å‚æ•°å¯ä»¥ä¿®æ”¹ï¼‰çš„è’™ç‰¹å¡æ´›æŠ½æ ·ï¼Œå› æ­¤è¿™ä¸ªç»“æœæ˜¯<strong>åŠå…¶è¿‘ä¼¼</strong>çš„ç»“æœï¼Œç›´æ¥ç”¨ä½œ RDA ä¸­è§£é‡Šå˜é‡çš„æ˜¾è‘—æ€§æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ç„¶è€Œï¼Œenvfit è¾“å‡ºçš„ç»“æœå¹¶éæ ‡å‡†çš„ data.frame æˆ–è€…ç±»ä¼¼çš„ç»“æœï¼Œæ— æ³•æ–¹ä¾¿çš„è¾“å‡ºæˆ–è€…è¿›è¡Œåˆ†æï¼Œåç»­æˆ‘ä»¬è¿˜ä¼šè¿›è¡Œç»“æœæå–çš„æ­¥éª¤ï¼Œæš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚</p>
<h2 id="rda-å’Œ-envfit-åˆ†æ">RDA å’Œ ENVFIT åˆ†æ</h2>
<p>æ­¤ä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºæŠ½å–çš„ 150 æ¡åœŸå£¤çº¿è™«ç¾¤è½ç¾¤è½æ•°æ®ä»¥åŠå¯¹åº”çš„ç¯å¢ƒæ•°æ®ï¼Œç”±äºä¸å½±å“åç»­çš„ç†è§£ä»¥åŠç‰ˆæƒè€ƒé‡ï¼Œå¯¹å„å‚æ•°åä¸å†è§£é‡Šã€‚</p>
<p>æ¯ä¸€æ­¥çš„æ“ä½œä»¥åŠåŸå› ä»¥æ³¨é‡Šçš„å½¢å¼å‘ˆç°ã€‚</p>
<pre><code class="language-R">library('tidyverse')

# read Environmental Variables
df_env &lt;- read_csv('df_env_smp.csv')
# read Community composition matrix
df_com &lt;- read_csv('df_com_smp.csv')

# View the structure of data
head(df_env)
head(df_com)
</code></pre>
<pre><code>Parsed with column specification:
cols(
  pH = [32mcol_double()[39m,
  MOI = [32mcol_double()[39m,
  TN = [32mcol_double()[39m,
  TP = [32mcol_double()[39m,
  AP = [32mcol_double()[39m,
  NH4 = [32mcol_double()[39m,
  NO3 = [32mcol_double()[39m,
  SOC = [32mcol_double()[39m,
  MAT = [32mcol_double()[39m,
  MAP = [32mcol_double()[39m,
  PBM = [32mcol_double()[39m,
  PCV = [32mcol_double()[39m,
  PSR = [32mcol_double()[39m
)

Parsed with column specification:
cols(
  pp = [32mcol_double()[39m,
  ba = [32mcol_double()[39m,
  fu = [32mcol_double()[39m,
  pr = [32mcol_double()[39m,
  om = [32mcol_double()[39m
)
</code></pre>
<table>
<caption>A tibble: 6 Ã— 13</caption>
<thead>
	<tr><th scope=col>pH</th><th scope=col>MOI</th><th scope=col>TN</th><th scope=col>TP</th><th scope=col>AP</th><th scope=col>NH4</th><th scope=col>NO3</th><th scope=col>SOC</th><th scope=col>MAT</th><th scope=col>MAP</th><th scope=col>PBM</th><th scope=col>PCV</th><th scope=col>PSR</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>-1.6396547</td><td>-0.1610384</td><td>-0.1162406</td><td>-0.44892589</td><td> 0.17966965</td><td> 0.4471754</td><td>-0.5148515</td><td>-0.292278803</td><td> 0.8420221</td><td> 0.02487222</td><td> 0.17638650</td><td> 0.426595458</td><td> 0.2275781</td></tr>
	<tr><td> 0.9429126</td><td>-0.5549069</td><td>-0.7919730</td><td> 0.02952209</td><td>-0.78701735</td><td>-0.3426843</td><td>-0.4197756</td><td>-0.697789311</td><td>-1.5519670</td><td> 0.27013035</td><td>-0.02465146</td><td> 0.008333099</td><td>-0.8352947</td></tr>
	<tr><td>-1.3387571</td><td>-0.2762522</td><td> 0.1998817</td><td>-0.14900328</td><td>-0.10273314</td><td> 0.7179844</td><td>-0.4922144</td><td> 0.461059956</td><td>-0.8480169</td><td> 1.21243154</td><td> 0.73829039</td><td>-0.793336422</td><td> 0.8349340</td></tr>
	<tr><td>-1.2035947</td><td>-0.1658411</td><td>-0.2600847</td><td>-0.45606691</td><td> 0.09277663</td><td>-0.1328073</td><td>-0.1677489</td><td>-0.007572046</td><td> 0.7833595</td><td>-0.87351309</td><td>-0.80968336</td><td>-0.514494850</td><td>-1.2908116</td></tr>
	<tr><td>-1.1762407</td><td> 1.0043821</td><td> 0.2918750</td><td>-0.47748995</td><td> 2.24338416</td><td> 0.7924569</td><td>-0.5827629</td><td> 0.035809220</td><td>-0.2893264</td><td>-0.22471654</td><td> 0.12645186</td><td> 0.182609082</td><td> 0.9867730</td></tr>
	<tr><td> 0.4263991</td><td> 0.5467350</td><td>-0.3570957</td><td>-0.12043922</td><td> 0.54896611</td><td>-0.3652517</td><td>-0.5540892</td><td>-0.360483891</td><td>-0.8480169</td><td> 1.21243154</td><td> 2.11789718</td><td>-0.026522097</td><td> 0.6830950</td></tr>
</tbody>
</table>
<table>
<caption>A tibble: 6 Ã— 5</caption>
<thead>
	<tr><th scope=col>pp</th><th scope=col>ba</th><th scope=col>fu</th><th scope=col>pr</th><th scope=col>om</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>  2.550000</td><td>28.010000</td><td> 2.550000</td><td>2.550000</td><td>15.280000</td></tr>
	<tr><td>  1.311046</td><td> 7.316707</td><td> 1.337884</td><td>1.337884</td><td> 5.953381</td></tr>
	<tr><td>  8.250000</td><td>13.255000</td><td> 3.355000</td><td>0.000000</td><td>14.850000</td></tr>
	<tr><td>102.490000</td><td>18.516667</td><td>20.946667</td><td>0.000000</td><td>23.500000</td></tr>
	<tr><td> 21.350000</td><td>52.720000</td><td>14.846667</td><td>0.000000</td><td> 5.623333</td></tr>
	<tr><td>  2.490000</td><td> 4.965000</td><td> 1.245000</td><td>0.000000</td><td> 2.475000</td></tr>
</tbody>
</table>
<pre><code class="language-R">library('vegan')

# Performing RDA and viewing the results
res_rda &lt;- rda(df_com, df_env)
res_rda

# Performing ENVFIT
res_envfit &lt;- envfit(df_com, df_env)

# However, the result of ENVFIT is not in the data.frame format, we should extract useful information from it.
res_envfit
</code></pre>
<pre><code>Call: rda(X = df_com, Y = df_env)

                Inertia Proportion Rank
Total         2031.7341     1.0000     
Constrained    895.7317     0.4409    5
Unconstrained 1136.0024     0.5591    5
Inertia is variance 

Eigenvalues for constrained axes:
 RDA1  RDA2  RDA3  RDA4  RDA5 
754.0  88.3  45.4   6.2   1.8 

Eigenvalues for unconstrained axes:
  PC1   PC2   PC3   PC4   PC5 
747.4 235.0  96.3  44.7  12.6 





***VECTORS

          pp       ba     r2 Pr(&gt;r)    
pH  -0.94935  0.31421 0.0809  0.003 ** 
MOI  0.79143  0.61126 0.2636  0.001 ***
TN   0.91399  0.40574 0.0887  0.004 ** 
TP   0.86358 -0.50421 0.0002  0.984    
AP   0.99269  0.12071 0.0575  0.026 *  
NH4  0.94495 -0.32722 0.0462  0.033 *  
NO3  0.52786  0.84933 0.1430  0.002 ** 
SOC  0.81629  0.57764 0.1440  0.001 ***
MAT  0.10537 -0.99443 0.0118  0.405    
MAP -0.18615 -0.98252 0.0073  0.579    
PBM  0.75360  0.65733 0.0096  0.508    
PCV  0.57508  0.81810 0.0380  0.072 .  
PSR  0.88521 -0.46519 0.0062  0.639    
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
Permutation: free
Number of permutations: 999
</code></pre>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨æ³¨é‡Šæåˆ°çš„ï¼ŒENVFIT å¹¶ä¸æ˜¯ä»¥ data.frame çš„å½¢å¼æä¾›æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡ä¸€äº›æå–çš„æ“ä½œæ‰èƒ½è·å¾—ä¸ç»“æœç›¸åŒçš„è¡¨æ ¼ã€‚ç”±äºè¿™ç±»æ“ä½œç»å¸¸ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶åŒ…è£…æˆ function å¹¶å‘½åä¸º envfit_to_df</p>
<pre><code class="language-R"># Here, env_obj indicates the result of envfit. In this case, it's the res_envfit.
# r2_dig is the significant figure of R2
# p_dig is the significant figure of p value
envfit_to_df &lt;- function(env_obj,
                         r2_dig = 6,
                         p_dig = 3) {
  r2_fmt &lt;- as.character(paste('%.', r2_dig, 'f', sep = ''))
  p_fmt &lt;- as.character(paste('%.', p_dig, 'f', sep = ''))
  tibble(
      # the name of explainary variables
    factor = names(env_obj$vectors$r),
      # list or vector of R2
    r2 = env_obj$vectors$r,
      # list or vector of p values
    pvals = env_obj$vectors$pvals
  ) %&gt;%
    # generate significant levels by p values
    mutate(sig = case_when(
      pvals &lt;= 0.001 ~ '***',
      pvals &lt;= 0.01 ~ '**',
      pvals &lt;= 0.05 ~ '*',
      TRUE ~ ' '
    )) %&gt;%
    # format the significant figure by format definition before.
    mutate(pvals = sprintf('%.3f', pvals),
           r2 = sprintf(r2_fmt, r2))
}
# Convert result of ENVFIT to data.frame, in fact, it's a tibble.
df_env &lt;- envfit_to_df(res_envfit, r2_dig = 3)
df_env
</code></pre>
<table>
<caption>A tibble: 13 Ã— 4</caption>
<thead>
	<tr><th scope=col>factor</th><th scope=col>r2</th><th scope=col>pvals</th><th scope=col>sig</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>pH </td><td>0.081</td><td>0.003</td><td>** </td></tr>
	<tr><td>MOI</td><td>0.264</td><td>0.001</td><td>***</td></tr>
	<tr><td>TN </td><td>0.089</td><td>0.004</td><td>** </td></tr>
	<tr><td>TP </td><td>0.000</td><td>0.984</td><td>   </td></tr>
	<tr><td>AP </td><td>0.058</td><td>0.026</td><td>*  </td></tr>
	<tr><td>NH4</td><td>0.046</td><td>0.033</td><td>*  </td></tr>
	<tr><td>NO3</td><td>0.143</td><td>0.002</td><td>** </td></tr>
	<tr><td>SOC</td><td>0.144</td><td>0.001</td><td>***</td></tr>
	<tr><td>MAT</td><td>0.012</td><td>0.405</td><td>   </td></tr>
	<tr><td>MAP</td><td>0.007</td><td>0.579</td><td>   </td></tr>
	<tr><td>PBM</td><td>0.010</td><td>0.508</td><td>   </td></tr>
	<tr><td>PCV</td><td>0.038</td><td>0.072</td><td>   </td></tr>
	<tr><td>PSR</td><td>0.006</td><td>0.639</td><td>   </td></tr>
</tbody>
</table>
<p>æˆªæ­¢åˆ°ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å®Œæˆäº† RDA åˆ†æä»¥åŠ ENVFIT åˆ†æï¼Œå¹¶å°†æ•°æ®è½¬æ¢æˆä¸ºäº†æ»¡è¶³å¯è§†åŒ–éœ€æ±‚çš„æ ¼å¼ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦è¿›è¡Œå¯è§†åŒ–ä½œä¸šã€‚æ­¤ä¾‹ï¼Œç¬”è€…ä»…éœ€è¦æ˜¾ç¤ºç¯å¢ƒå˜é‡ä¸ç‰©ç§ä¿¡æ¯ï¼Œä¸éœ€è¦æ˜¾ç¤ºæ ·åœ°ä¿¡æ¯ï¼Œå› æ­¤ç»˜åˆ¶ä¸­ä»…ä¿ç•™äº†æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¦‚éœ€æ˜¾ç¤ºæ ·åœ°ä¿¡æ¯ï¼Œè¯·æŒ‰å®é™…éœ€æ±‚æ›´æ”¹ã€‚</p>
<p>ç»˜åˆ¶ RDA å›¾å½¢æ˜¯å¸¸ç”¨çš„æ“ä½œï¼Œå› æ­¤åŒæ ·å°†å®ƒåŒ…è£…æˆä¸º function å¹¶å‘½åä¸º <code>ggRDA</code></p>
<pre><code class="language-R"># Here, rda_obj means the object which is from vegan::rda
# sp_size means the text size of species
# arrow_txt_size means the environmet variable names at the end of the arrow
# Because not every RDA plot needs indicate significant correlations, the envfit_df is optional here.
ggRDA &lt;- function(rda_obj,sp_size = 4,arrow_txt_size = 4, envfit_df) {
    # ggplot doesn't support rda object directly, we use ggvegan::fortify function to convert the rda to data.frame
    fmod &lt;- fortify(rda_obj)
    # to get the arrow of biplot, we plot rda by vegan::plot.rda function firstly. 
    # The arrow attributes contain in the attributes(plot_obejct$biplot)$arrow.mul
    basplot &lt;- plot(rda_obj)
    mult &lt;- attributes(basplot$biplot)$arrow.mul
  
    # To check if envfit_df exists or not
    # If envfit_df exists, join the fortified rda_obj and envfit to mark which variable is significant.
    if(missingArg(envfit_df)){
        bplt_df &lt;- filter(fmod, Score == &quot;biplot&quot;) %&gt;%
        # If there is no requirement to mark significant variable
        # use the sytle of sinificant (black bolder solid arrow)
        # to paint the arrow
        mutate(bold = 'sig')
    } else {
        bplt_df &lt;- filter(fmod, Score == &quot;biplot&quot;) %&gt;%
        left_join(envfit_df, by = c('Label' = 'factor')) %&gt;%
        # To mark the significant variables as sig, not significant variables as ns
        # these information are stored in bold column
        mutate(bold = ifelse(str_detect(sig, fixed('*')), 'sig', 'ns'))
    }
  ggplot(fmod, aes(x = RDA1, y = RDA2)) +
    coord_fixed() +
    geom_segment(data = bplt_df,
                 # mult and RDA1/RDA2 are from fortified RDA data.frame
                 # they contain the direction and effects of every variabl
                 # their products are the direction and length of arrows
                 aes(x = 0, xend = mult * RDA1,
                     y = 0, yend = mult * RDA2,
                     # Use different arrow size to indicate the significant level
                     size = bold,
                     # Use different arrow color to indicate the significant level
                     color = bold,
                     # Use different arrow linetype to indicate the significant level
                     linetype = bold),
                 #############################
                 # Q:Why use three different attibution to control the significant levels?
                     # It is redundancy, isn't it?
                 # A: In fact, it's not easy to recongize the significant level by one kind attribution
                     # Becasue it is not delicate to indicate it with supper bold and supper thin arrow,
                     # by the same logic, high contrast colors are not delicate neither.
                     # As for the line type, some arrow are really short, it's not easy to recognize
                     # weather it is solid or dashed line at all.
                     # To sum up, we use three different attributions
                     # to indicate the same difference to avoid any misleading.
                 #############################
                 # to control the size of the header of arrow
                 arrow = arrow(length = unit(0.25, &quot;cm&quot;)), 
                ) +
    # Add the text of variable name at the end of arrow
    geom_text(data =  subset(fmod, Score == &quot;biplot&quot;),
              aes(x = (mult + mult/10) * RDA1,
                   #we add 10% to the text to push it slightly out from arrows
                  y = (mult + mult/10) * RDA2,
                  label = Label),
              size = arrow_txt_size,
               #otherwise you could use hjust and vjust. I prefer this option
              hjust = 0.5) +
    # Add the text of species
    geom_text(
      data = subset(fmod, Score == &quot;species&quot;),
      aes(colour = &quot;species&quot;,label = Label),
      size = sp_size
    )
}
</code></pre>
<p>è™½ç„¶ä½¿ç”¨ ggRDA å¯ä»¥ç›´æ¥ç»˜åˆ¶å›¾å½¢ï¼Œä½†é€šå¸¸ä¸ºäº†ç¾è§‚ï¼Œå¯¹äºç‰¹å®šçš„å‚æ•°è¿˜éœ€è¦è¿›ä¸€æ­¥çš„è°ƒæ•´ã€‚</p>
<p>æ³¨æ„ï¼Œç”±äºåœ¨ ggRDA ä¸­ä½¿ç”¨äº† vegan::plot.rda ç»˜åˆ¶å›¾åƒï¼Œæ‰€ä»¥åœ¨ä¸‹é¢çš„è°ƒç”¨ ggRDA ä¼šé¦–å…ˆç»˜åˆ¶ä¸€æ¬¡ç®€æ˜“çš„ rda å›¾åƒä¹‹åï¼Œå†æ˜¾ç¤ºå‡º ggplot2 ç»˜åˆ¶çš„å›¾å½¢ï¼Œä¸å½±å“åç»­çš„è¾“å‡ºä¿å­˜ã€‚</p>
<pre><code class="language-R">library(ggvegan)
# Get the amount of explanation by each axis
# gernerally, we choose the first two axes.
exp_by_x &lt;- (as.list(res_rda$CCA$eig)$RDA1)/(res_rda$tot.chi) * 100
exp_by_y &lt;- (as.list(res_rda$CCA$eig)$RDA2)/(res_rda$tot.chi) * 100
    
ggRDA(res_rda, envfit_df = df_env, sp_size = 5) +
    # Generally theme_classic is a good choice to paint a figure
    theme_classic() +
    # In general, we don't need to show the legend in RDA figure
    theme(legend.position = &quot;none&quot;) +
    xlab(paste('RDA1 (', round(exp_by_x, 2), '%)', sep = '')) +
    ylab(paste('RDA2 (', round(exp_by_y, 2), '%)', sep = '')) +
    # scale_XXXXX_manual series provide the ability
    # to define the style of legend by variable value
    scale_size_manual(values = c('ns' = .6,
                                 'sig' = .8)) +
    # Q: What's species here? I don't remember their is a significant level which is called 'species'
    # A: Indeed, their is no significant 'species'. However, 
        # the species name in RDA which is generated from geom_text contains colour attribution.
    scale_colour_manual(values = c(
        'ns' = '#606060',
        'sig' = 'black',
        'species' = 'red'
      )) +
    scale_linetype_manual(values = c('ns' = 8, 'sig' = 1))
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://picgo-1256649726.cos.ap-chengdu.myqcloud.com/output_8_1.png" alt="" loading="lazy"></figure>
<p>æœ€åå¾ˆç®€å•äº†ï¼Œä½¿ç”¨ ggsave å°† RDA å›¾ä¿å­˜æˆä½ éœ€è¦çš„æ ¼å¼å°±å¯ä»¥ã€‚</p>
<p>Tips: è‡ªç„¶ç§‘å­¦æœŸåˆŠçš„æŠ•ç¨¿ç³»ç»Ÿé€šå¸¸æ”¯æŒä¸Šä¼  PDF æ ¼å¼çš„å›¾ç‰‡ï¼Œæ ¹æ®å®é™…æƒ…å†µä¹Ÿæ¨èä½¿ç”¨ ggsave è¾“å‡º PDF æ ¼å¼ã€‚</p>
<p>æ­¤æ—¶æ— éœ€è®¾ç½® DPI ä¹Ÿæ— æ³•è®¾ç½® DPIï¼Œè¿™æ˜¯å› ä¸ºï¼Œggsave ä¿å­˜çš„ PDF æ–‡ä»¶ä¼šä¼˜å…ˆå°†å›¾ç‰‡è¾“å‡ºä¸ºçŸ¢é‡å›¾ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯å›¾ç‰‡æ— è®ºå¦‚ä½•æ”¾å¤§ï¼Œéƒ½ä¸ä¼šå˜å¾—æ¨¡ç³Šï¼Œè€ŒæœŸåˆŠçš„æ’ç‰ˆç³»ç»Ÿä¹Ÿèƒ½å¾ˆå¥½çš„å¤„ç†è¿™ç§çŸ¢é‡å›¾ã€‚</p>
<p>åªè¦ç»™ PDF å›¾ç‰‡è®¾å®šä¸€ä¸ªåˆé€‚çš„å®½é«˜ï¼Œå°±æ— éœ€æ‹…å¿ƒå›¾ç‰‡ä¼šå˜å¾—ä¸æ¸…æ™°ç­‰å¥‡å¥‡æ€ªæ€ªçœ‹ä¼¼ç„å­¦çš„é—®é¢˜äº†ã€‚</p>
<p>ä¸è¿‡å¦‚æœæœ‰ä¿®æ”¹å­—ä½“çš„éœ€æ±‚ï¼Œä¹Ÿè®¸ PDF ä¼šæŠ¥é”™ï¼Œç±»ä¼¼äºå­—ä½“æ— æ³•åµŒå…¥ï¼Œæ­¤æ—¶è¾“å‡ºçš„ PDF æ–‡ä»¶æ‰€æœ‰çš„æ–‡å­—éƒ½ä¼šæ¶ˆå¤±ã€‚å…³äºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåç»­ä¹Ÿè®¸ä¼šè¿›è¡Œè¿›ä¸€æ­¥çš„è®¨è®ºã€‚</p>
<pre><code class="language-R">ggsave('RDA.pdf',width = 7)
</code></pre>
<pre><code>Saving 7 x 7 in image
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://womeimingzi11.github.io/tag/k6t2t6ELl/" class="tag">
                    Analysis
                  </a>
                
                  <a href="https://womeimingzi11.github.io/tag/X1VkNLzBV/" class="tag">
                    R
                  </a>
                
                  <a href="https://womeimingzi11.github.io/tag/ENAyDyZ5tK/" class="tag">
                    ecology
                  </a>
                
                  <a href="https://womeimingzi11.github.io/tag/NOVxTpueqQ/" class="tag">
                    using-r-for-everything
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://womeimingzi11.github.io/post/she-bei-guan-li-qi-zhong-de-mvsi-card-reader-usb-device-driver-shi-shi-me-ru-he-yi-chu-qi-zhan-yong-pan-fu/">
                  <h3 class="post-title">
                    è®¾å¤‡ç®¡ç†å™¨ä¸­çš„ MVSI Card Reader USB Device driver æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç§»é™¤å…¶å ç”¨ç›˜ç¬¦ï¼Ÿ
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
